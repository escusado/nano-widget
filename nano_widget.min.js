'use strict';

function includes(...modules){let desc,_Mix=class{};if(modules.filter((module)=>{return module.name==='NanoWidget'}).length){modules.splice(modules.indexOf(NanoWidget),1);_Mix=class extends NanoWidget{}}for(let module of modules){for(let key of Object.getOwnPropertyNames(module.prototype)){desc=Object.getOwnPropertyDescriptor(module.prototype,key);if(key!=='constructor'&&key!=='name'){Object.defineProperty(_Mix.prototype,key,desc)}}}return _Mix}
class CustomEvent{constructor(type,data){this.bubbles=true;this.cancelable=true;this.currentTarget=null;this.timeStamp=0;this.target=null;this.type='';this.isPropagationStopped=false;this.isDefaultPrevented=false;this.isImmediatePropagationStopped=false;this.areImmediateHandlersPrevented=false;this.type=type;if(typeof data!=='undefined'){Object.assign(this,data)}}stopPropagation(){this.isPropagationStopped=true}preventDefault(){this.isDefaultPrevented=true}stopImmediatePropagation(){this.preventImmediateHandlers();this.stopPropagation()}preventImmediateHandlers(){this.areImmediateHandlersPrevented=true}}
class NanoCustomEventSupport{bind(type,eventHandler){let found,i,listeners;if(!this.eventListeners){this.eventListeners={}}if(!this.eventListeners[type]){this.eventListeners[type]=[]}found=false;listeners=this.eventListeners[type];for(i=0;i<listeners.length;i++){if(listeners[i]===eventHandler){found=true;break}}if(!found){this.eventListeners[type].push(eventHandler)}return this}unbind(type,eventHandler){let i,found,listeners;found=false;i=0;if(!this.eventListeners){this.eventListeners={}}if(typeof eventHandler=='undefined'){this.eventListeners[type]=[]}listeners=this.eventListeners[type];for(i=0;i<listeners.length;i++){if(listeners[i]==eventHandler){found=true;break}}if(found){this.eventListeners[type].splice(i,1)}return this}unbindAll(){if(this.eventListeners){this.eventListeners=null}return this}dispatch(type,data){let event,listeners,instance,i;if(!this.eventListeners){this.eventListeners={}}if(typeof data==='undefined'){data={}}if(data.hasOwnProperty('target')===false){data.target=this}event=new CustomEvent(type,data);listeners=this.eventListeners[type]||[];instance=this;for(i=0;i<listeners.length;i=i+1){listeners[i].call(instance,event);if(event.areImmediateHandlersPrevented===true){break}}return event}}
class NanoNodeSupport{appendChild(child){if(child.parent){child.parent.removeChild(child)}if(!this.hasOwnProperty('children')){this.children=[]}this.children.push(child);if(child.name){this[child.name]=child}child.setParent(this);return child}removeChild(child){let position=this.children.indexOf(child);if(position!==-1){this.children.splice(position,1);delete this[child.name];child.parent=null}return child}setParent(parent){this.parent=parent;return this}destroyChildren(){if(this.children){childrenLength=this.children.length;while(childrenLength>0){this.children[0].destroyChildren();if(this.children.length===childrenLength){this.children.shift()}childrenLength--}}this.children=null;return this}}
class NanoWidget extends includes(NanoCustomEventSupport,NanoNodeSupport){constructor(conf){super();let _defaults={html:null,element:null,active:false,disabled:false,__destroyed:false};Object.assign(_defaults,conf);Object.assign(this,_defaults);if(this._init){this._init(conf)}if(!this.element){this.element=this._getElement()}if(!this.class){this.class=this._getClass()}for(let className of this.class.split(' ')){this.element.classList.add(className)}}_getClass(){return''}_getElement(){let elementHolder=document.createElement('div'),htmlContent=this.html||this._getHTML().trim();elementHolder.innerHTML=htmlContent;if(elementHolder.childNodes.length>1){return elementHolder.childNodes}return elementHolder.firstChild}_getHTML(){return`<div></div>`}render(element,beforeElement){if(this.__destroyed===true){console.warn('calling on destroyed object')}this.dispatch('beforeRender',{element:element,beforeElement:beforeElement});this._render(element,beforeElement);this.dispatch('render');return this}_render(element,beforeElement){if(beforeElement){element.insertBefore(this.element,beforeElement)}else{element.appendChild(this.element)}return this}activate(){if(this.__destroyed){console.warn('calling on destroyed object')}this.dispatch('beforeActivate');this._activate();this.dispatch('activate');return this}_activate(){this.active=true;this.element.classList.add('active')}deactivate(){if(this.__destroyed){console.warn('calling on destroyed object')}this.dispatch('beforeDeactivate');this._deactivate();this.dispatch('deactivate');return this}_deactivate(){this.active=false;this.element.classList.remove('active')}enable(){if(this.__destroyed){console.warn('calling on destroyed object')}this.dispatch('beforeEnable');this._enable();this.dispatch('enable');return this}_enable(){this.disabled=false;this.element.classList.remove('disabled')}disable(){if(this.__destroyed){console.warn('calling on destroyed object')}this.dispatch('beforeDisable');this._disable();this.dispatch('disable');return this}_disable(){this.disabled=true;this.element.classList.add('disabled')}destroy(){if(this.__destroyed){console.warn('calling on destroyed object')}this.dispatch('beforeDestroy');this._destroy();this.dispatch('destroy');return null}_destroy(){this.destroyElement();this.destroyChildren();if(this.parent){this.parent.removeChild(this)}this.unbindAll();this.__destroyed=true}destroyElement(){this.dispatch('beforeDestroyElement');this._destroyElement();this.dispatch('destroyElement')}_destroyElement(){if(this.element){if(this.element.parentNode){this.element.parentNode.removeChild(this.element)}}this.element=null;return this}}
